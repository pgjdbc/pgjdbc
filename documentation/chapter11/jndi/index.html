<!doctype html><html><head><meta charset=utf-8><title>Pgjdbc | Data Sources and JNDI</title><link rel=stylesheet href=https://pgjdbc.github.io/pgjdbc/sass/main.e946902265096118ab63cb74d4453d2690cb98e02350ac6ad40325a645b55613.css integrity="sha256-6UaQImUJYRirY8t01EU9JpDLmOAjUKxq1AMlpkW1VhM="><link rel=icon href=favicon.ico type=image/x-icon><link rel="shortcut icon" href=favicon.ico type=image/x-icon></head><body><nav class=nav><a href=/pgjdbc><img src=/images/postgreslogo.svg></a><div class=nav__items><a class=nav__item href=/pgjdbc/development/>Development</a>
<a class=nav__item href=/pgjdbc/download/>Download</a>
<a class=nav__item href=/pgjdbc/documentation/>Documentation</a>
<a class=nav__item href=/pgjdbc/community/>Community</a></div><a href=https://github.com/pgjdbc/pgjdbc><img src=/images/github.svg></a></nav><main><div class=flex><nav role=navigation class=side__nav><ul><li><a href=/pgjdbc/documentation/chapter1/>Introduction</a><ul><li><a href=/pgjdbc/documentation/chapter1/intro/>Introduction</a></li></ul></li><li><a href=/pgjdbc/documentation/chapter2/>Setting up the JDBC Driver</a><ul><li><a href=/pgjdbc/documentation/chapter2/setup/>Getting the Driver</a></li><li><a href=/pgjdbc/documentation/chapter2/classpath/>Setting up the Class Path</a></li><li><a href=/pgjdbc/documentation/chapter2/prepare/>Preparing the Database Server for JDBC</a></li><li><a href=/pgjdbc/documentation/chapter2/your-database/>Creating a Database</a></li></ul></li><li><a href=/pgjdbc/documentation/chapter3/>Initializing the Driver</a><ul><li><a href=/pgjdbc/documentation/chapter3/use/>Importing JDBC</a></li><li><a href=/pgjdbc/documentation/chapter3/load/>Loading the Driver</a></li><li><a href=/pgjdbc/documentation/chapter3/connect/>Connecting to the Database</a></li></ul></li><li><a href=/pgjdbc/documentation/chapter4/>Using SSL</a><ul><li><a href=/pgjdbc/documentation/chapter4/ssl/>Configuring the Server</a></li><li><a href=/pgjdbc/documentation/chapter4/ssl-client/>Configuring the Client</a></li><li><a href=/pgjdbc/documentation/chapter4/ssl-factory/>Custom SSLSocketFactory</a></li></ul></li><li><a href=/pgjdbc/documentation/chapter5/>Issuing a Query and Processing the Result</a><ul><li><a href=/pgjdbc/documentation/chapter5/query/>Issuing a Query and Processing the Result</a></li><li><a href=/pgjdbc/documentation/chapter5/statement/>Using the Statement or PreparedStatement Interface</a></li><li><a href=/pgjdbc/documentation/chapter5/resultset/>Using the ResultSet Interface</a></li><li><a href=/pgjdbc/documentation/chapter5/update/>Performing Updates</a></li><li><a href=/pgjdbc/documentation/chapter5/ddl/>Creating and Modifying Database Objects</a></li><li><a href=/pgjdbc/documentation/chapter5/java8-date-time/>Using Java 8 Date and Time classes</a></li></ul></li><li><a href=/pgjdbc/documentation/chapter6/>Calling Stored Functions and Procedures</a><ul><li><a href=/pgjdbc/documentation/chapter6/callproc/>Calling Stored Functions and Procedures</a></li></ul></li><li><a href=/pgjdbc/documentation/chapter7/>Storing Binary Data</a><ul><li><a href=/pgjdbc/documentation/chapter7/binary-data/>Storing Binary Data</a></li></ul></li><li><a href=/pgjdbc/documentation/chapter8/>JDBC escapes</a><ul><li><a href=/pgjdbc/documentation/chapter8/escapes/>JDBC escapes</a></li><li><a href=/pgjdbc/documentation/chapter8/outer-joins-escape/>Escape for outer joins</a></li><li><a href=/pgjdbc/documentation/chapter8/escapes-datetime/>Date-time escapes</a></li><li><a href=/pgjdbc/documentation/chapter8/escaped-functions/>Escaped scalar functions</a></li></ul></li><li><a href=/pgjdbc/documentation/chapter9/>PostgreSQL™ Extensions to the JDBC API</a><ul><li><a href=/pgjdbc/documentation/chapter9/ext/>PostgreSQL™ Extensions to the JDBC API</a></li><li><a href=/pgjdbc/documentation/chapter9/geometric/>Geometric Data Types</a></li><li><a href=/pgjdbc/documentation/chapter9/largeobjects/>Large Objects</a></li><li><a href=/pgjdbc/documentation/chapter9/listennotify/>Listen / Notify</a></li><li><a href=/pgjdbc/documentation/chapter9/server-prepare/>Server Prepared Statements</a></li><li><a href=/pgjdbc/documentation/chapter9/parameterstatus/>Parameter Status Messages</a></li><li><a href=/pgjdbc/documentation/chapter9/replication/>Physical and Logical replication API</a></li><li><a href=/pgjdbc/documentation/chapter9/arrays/>Arrays</a></li></ul></li><li><a href=/pgjdbc/documentation/chapter10/>Using the Driver in a Multithreaded or a Servlet Environment</a><ul><li><a href=/pgjdbc/documentation/chapter10/thread/>Using the Driver in a Multithreaded or a Servlet Environment</a></li></ul></li><li><a href=/pgjdbc/documentation/chapter11/>Connection Pools and Data Sources</a><ul><li><a href=/pgjdbc/documentation/chapter11/datasource/>Connection Pools and Data Sources</a></li><li><a href=/pgjdbc/documentation/chapter11/ds-cpds/>Application Servers ConnectionPoolDataSource</a></li><li><a href=/pgjdbc/documentation/chapter11/ds-ds/>Applications DataSource</a></li><li><a href=/pgjdbc/documentation/chapter11/jndi/>Data Sources and JNDI</a></li><li><a href=/pgjdbc/documentation/chapter11/tomcat/>Tomcat setup</a></li></ul></li><li><a href=/pgjdbc/documentation/chapter12/>Logging using java.util.logging</a><ul><li><a href=/pgjdbc/documentation/chapter12/logging/>Logging using java.util.logging</a></li></ul></li><li><a href=/pgjdbc/documentation/chapter13/>Further Reading</a><ul><li><a href=/pgjdbc/documentation/chapter13/reading/>Further Reading</a></li></ul></li></ul></nav><article><h1>Data Sources and JNDI</h1><br><p>All the <code>ConnectionPoolDataSource</code> and <code>DataSource</code> implementations can be stored
in JNDI. In the case of the nonpooling implementations, a new instance will be
created every time the object is retrieved from JNDI, with the same settings as
the instance that was stored. For the pooling implementations, the same instance
will be retrieved as long as it is available (e.g., not a different JVM retrieving
the pool from JNDI), or a new instance with the same settings created otherwise.</p><p>In the application server environment, typically the application server&rsquo;s
<code>DataSource</code> instance will be stored in JNDI, instead of the PostgreSQL™
<code>ConnectionPoolDataSource</code> implementation.</p><p>In an application environment, the application may store the <code>DataSource</code> in JNDI
so that it doesn&rsquo;t have to make a reference to the <code>DataSource</code> available to all
application components that may need to use it. An example of this is shown in
<a href=jndi.html#ds-jndi>Example 11.2, “<code>DataSource</code> JNDI Code Example”</a>.</p><p><strong>Example 11.2. <code>DataSource</code> JNDI Code Example</strong></p><p>Application code to initialize a pooling <code>DataSource</code> and add it to JNDI might
look like this:</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=n>PGPoolingDataSource</span> <span class=n>source</span> <span class=o>=</span> <span class=k>new</span> <span class=n>PGPoolingDataSource</span><span class=o>();</span>
<span class=n>source</span><span class=o>.</span><span class=na>setDataSourceName</span><span class=o>(</span><span class=s>&#34;A Data Source&#34;</span><span class=o>);</span>
<span class=n>source</span><span class=o>.</span><span class=na>setServerName</span><span class=o>(</span><span class=s>&#34;localhost&#34;</span><span class=o>);</span>
<span class=n>source</span><span class=o>.</span><span class=na>setDatabaseName</span><span class=o>(</span><span class=s>&#34;test&#34;</span><span class=o>);</span>
<span class=n>source</span><span class=o>.</span><span class=na>setUser</span><span class=o>(</span><span class=s>&#34;testuser&#34;</span><span class=o>);</span>
<span class=n>source</span><span class=o>.</span><span class=na>setPassword</span><span class=o>(</span><span class=s>&#34;testpassword&#34;</span><span class=o>);</span>
<span class=n>source</span><span class=o>.</span><span class=na>setMaxConnections</span><span class=o>(</span><span class=n>10</span><span class=o>);</span>
<span class=k>new</span> <span class=n>InitialContext</span><span class=o>().</span><span class=na>rebind</span><span class=o>(</span><span class=s>&#34;DataSource&#34;</span><span class=o>,</span> <span class=n>source</span><span class=o>);</span>
</code></pre></div><p>Then code to use a connection from the pool might look like this:</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=n>Connection</span> <span class=n>conn</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
<span class=k>try</span>
<span class=o>{</span>
    <span class=n>DataSource</span> <span class=n>source</span> <span class=o>=</span> <span class=o>(</span><span class=n>DataSource</span><span class=o>)</span><span class=k>new</span> <span class=n>InitialContext</span><span class=o>().</span><span class=na>lookup</span><span class=o>(</span><span class=s>&#34;DataSource&#34;</span><span class=o>);</span>
    <span class=n>conn</span> <span class=o>=</span> <span class=n>source</span><span class=o>.</span><span class=na>getConnection</span><span class=o>();</span>
    <span class=c1>// use connection
</span><span class=c1></span><span class=o>}</span>
<span class=k>catch</span> <span class=o>(</span><span class=n>SQLException</span> <span class=n>e</span><span class=o>)</span>
<span class=o>{</span>
    <span class=c1>// log error
</span><span class=c1></span><span class=o>}</span>
<span class=k>catch</span> <span class=o>(</span><span class=n>NamingException</span> <span class=n>e</span><span class=o>)</span>
<span class=o>{</span>
    <span class=c1>// DataSource wasn&#39;t found in JNDI
</span><span class=c1></span><span class=o>}</span>
<span class=k>finally</span>
<span class=o>{</span>
    <span class=k>if</span> <span class=o>(</span><span class=n>con</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span>
    <span class=o>{</span>
        <span class=k>try</span> <span class=o>{</span> <span class=n>conn</span><span class=o>.</span><span class=na>close</span><span class=o>();</span> <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>SQLException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{}</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></div><br><div class=prev__next><p><a title="Next page in Applications DataSource" href=https://pgjdbc.github.io/pgjdbc/documentation/chapter11/ds-ds/>Applications DataSource | 35</a></p><p><a title="Previous page in Tomcat setup" href=https://pgjdbc.github.io/pgjdbc/documentation/chapter11/tomcat/>Tomcat setup | 37</a></p></div></article><aside></aside></div></main><footer class=footer><div class=footer__items><div class=footer__items__links><ul><li>Pgjdbc</li><li><a href=https://jdbc.postgresql.org/documentation/publicapi/index.html>Public API</a></li><li><a href=https://www.postgresql.org/>About PostgreSql</a></li></ul></div><div class=footer__items__links><ul><li>Community</li><li><a href=https://jdbc.postgresql.org/documentation/publicapi/index.html>Slack</a></li><li><a href=https://www.postgresql.org/>Twitter</a></li><li><a href=https://www.postgresql.org/>Mailing List</a></li></ul></div><div class=footer__items__links><ul><li>More</li><li><a href=https://jdbc.postgresql.org/documentation/publicapi/index.html>FAQ</a></li><li><a href=https://www.postgresql.org/>Privacy</a></li><li><a href=https://www.postgresql.org/>License</a></li></ul></div></div><p class=copyright>Copyright © 1996-2022 The PostgreSQL Global Development Group</p></footer></body></html>