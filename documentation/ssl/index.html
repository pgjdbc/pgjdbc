<!doctype html><html><head><meta charset=utf-8><link rel=preload href=https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-100.woff as=font type=font/woff crossorigin><link rel=preload href=https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-100italic.woff as=font type=font/woff crossorigin><link rel=preload href=https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-200.woff as=font type=font/woff crossorigin><link rel=preload href=https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-200italic.woff as=font type=font/woff crossorigin><link rel=preload href=https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-300.woff as=font type=font/woff crossorigin><link rel=preload href=https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-300italic.woff as=font type=font/woff crossorigin><link rel=preload href=https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-400.woff as=font type=font/woff crossorigin><link rel=preload href=https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-400italic.woff as=font type=font/woff crossorigin><link rel=preload href=https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-500.woff as=font type=font/woff crossorigin><link rel=preload href=https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-500italic.woff as=font type=font/woff crossorigin><link rel=preload href=https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-600.woff as=font type=font/woff crossorigin><link rel=preload href=https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-600italic.woff as=font type=font/woff crossorigin><link rel=preload href=https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-700.woff as=font type=font/woff crossorigin><link rel=preload href=https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-700italic.woff as=font type=font/woff crossorigin><link rel=preload href=https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-800.woff as=font type=font/woff crossorigin><link rel=preload href=https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-800italic.woff as=font type=font/woff crossorigin><link rel=preload href=https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-900.woff as=font type=font/woff crossorigin><link rel=preload href=https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-900italic.woff as=font type=font/woff crossorigin><title>Using SSL | pgJDBC</title><meta name=viewport content="width=device-width,minimum-scale=1"><link rel=stylesheet href=https://pgjdbc.github.io/pgjdbc/sass/main.058073a16966b42041e1607953d1fa4851815aa8e96712e1124742cde0e7d93f.css integrity="sha256-BYBzoWlmtCBB4WB5U9H6SFGBWqjpZxLhEkdCzeDn2T8="><link rel=icon href=/pgjdbc/favicon.ico><script src=https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.9/lunr.min.js integrity="sha512-4xUl/d6D6THrAnXAwGajXkoWaeMNwEKK4iNfq5DotEbLPAfk6FSxSP3ydNxqDgCw1c/0Z1Jg6L8h2j+++9BZmg==" crossorigin=anonymous referrerpolicy=no-referrer></script><script defer language=javascript type=module src=/pgjdbc/js/index.js></script></head><body><nav class=navbar role=navigation><a href=/pgjdbc id=host><img class=logo src=/pgjdbc/icons/postgreslogo.svg alt=logo></a><div class=navbar__item><a href=/pgjdbc/download/ class=navbar__item__link>Download</a>
<a href=/pgjdbc/documentation/ class=navbar__item__link>Documentation</a>
<a href=/pgjdbc/community/ class=navbar__item__link>Community</a>
<a href=/pgjdbc/development/ class=navbar__item__link>Development</a>
<a href=/pgjdbc/changelogs/ class=navbar__item__link>Changelogs</a></div><form id=search class=searchBox role=search><input class=searchInput type=search placeholder=Search id=search-input autocomplete=off>
<button class=searchButton for=search-input><svg fill="#fff" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="24" height="24"><path d="M24 2.8886719C12.365714 2.8886719 2.8886719 12.365723 2.8886719 24S12.365714 45.111328 24 45.111328C29.036552 45.111328 33.664698 43.331333 37.298828 40.373047L52.130859 58.953125S55.379484 59.435984 57.396484 57.333984C59.427484 55.215984 58.951172 52.134766 58.951172 52.134766L40.373047 37.298828C43.331332 33.664697 45.111328 29.036548 45.111328 24 45.111328 12.365723 35.634286 2.8886719 24 2.8886719zM24 7.1113281C33.352549 7.1113281 40.888672 14.647457 40.888672 24S33.352549 40.888672 24 40.888672C14.647451 40.888672 7.1113281 33.352543 7.1113281 24 7.1113281 14.647457 14.647451 7.1113281 24 7.1113281z"/></svg></button></form><template id=search-result hidden><article class="search-list container flow"><h2><a class=summary-title-link></a></h2><summary class=summary></summary><div class=read-more-container><a class=read-more-link>Read More »</a></div></article></template></nav><main role=main class=main-inner><div class=doc><nav role=navigation class=sidebar><ul role=list class="flow sidebar__wrapper"><li role=listitem class=sidebar__links><a href=/pgjdbc/documentation/setup/ class=sidebar__links__link>Getting Started</a></li><li role=listitem class=sidebar__links><a href=/pgjdbc/documentation/use/ class=sidebar__links__link>Initializing the Driver</a></li><li role=listitem class=sidebar__links><a href=/pgjdbc/documentation/ssl/ class=sidebar__links__link--active>Using SSL</a></li><li role=listitem class=sidebar__links><a href=/pgjdbc/documentation/query/ class=sidebar__links__link>Issuing a Query and Processing the Result</a></li><li role=listitem class=sidebar__links><a href=/pgjdbc/documentation/callproc/ class=sidebar__links__link>Calling Stored Functions and Procedures</a></li><li role=listitem class=sidebar__links><a href=/pgjdbc/documentation/binary-data/ class=sidebar__links__link>Storing Binary Data</a></li><li role=listitem class=sidebar__links><a href=/pgjdbc/documentation/escapes/ class=sidebar__links__link>JDBC escapes</a></li><li role=listitem class=sidebar__links><a href=/pgjdbc/documentation/server-prepare/ class=sidebar__links__link>PostgreSQL™ Extensions to the JDBC API</a></li><li role=listitem class=sidebar__links><a href=/pgjdbc/documentation/thread/ class=sidebar__links__link>Using the Driver in a Multithreaded or a Servlet Environment</a></li><li role=listitem class=sidebar__links><a href=/pgjdbc/documentation/datasource/ class=sidebar__links__link>Connection Pools and Data Sources</a></li><li role=listitem class=sidebar__links><a href=/pgjdbc/documentation/logging/ class=sidebar__links__link>Logging using java.util.logging</a></li><li role=listitem class=sidebar__links><a href=/pgjdbc/documentation/reading/ class=sidebar__links__link>Further Reading</a></li></ul></nav><article class=article><h1>Using SSL</h1><p>Configuring the PostgreSQL™ server for SSL is covered in the <a href=https://www.postgresql.org/docs/current/ssl-tcp.html>main documentation</a>, so it will not be repeated here. There are also instructions in the source <a href=https://github.com/pgjdbc/pgjdbc/tree/master/certdir>certdir</a>
Before trying to access your SSL enabled server from Java, make sure
you can get to it via <strong>psql</strong>. You should see output like the following
if you have established a SSL connection.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ ./bin/psql -h localhost -U postgres
psql <span class=o>(</span>9.6.2<span class=o>)</span>
SSL connection <span class=o>(</span>protocol: TLSv1.2, cipher: ECDHE-RSA-AES256-GCM-SHA384, bits: 256, compression: off<span class=o>)</span>
Type <span class=s2>&#34;help&#34;</span> <span class=k>for</span> help.

<span class=nv>postgres</span><span class=o>=</span><span class=c1>#</span>
</code></pre></div><h2 id=custom-sslsocketfactory class=self-link>Custom SSLSocketFactory <a class=header-link href=#custom-sslsocketfactory><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" style="fill:#0093af"><path d="M8.465 11.293c1.133-1.133 3.109-1.133 4.242.0l.707.707 1.414-1.414-.707-.707c-.943-.944-2.199-1.465-3.535-1.465s-2.592.521-3.535 1.465L4.929 12a5.008 5.008.0 000 7.071 4.983 4.983.0 003.535 1.462A4.982 4.982.0 0012 19.071l.707-.707-1.414-1.414-.707.707a3.007 3.007.0 01-4.243.0 3.005 3.005.0 010-4.243l2.122-2.121z"/><path d="m12 4.929-.707.707 1.414 1.414.707-.707a3.007 3.007.0 014.243.0 3.005 3.005.0 010 4.243l-2.122 2.121c-1.133 1.133-3.109 1.133-4.242.0L10.586 12l-1.414 1.414.707.707c.943.944 2.199 1.465 3.535 1.465s2.592-.521 3.535-1.465L19.071 12a5.008 5.008.0 000-7.071 5.006 5.006.0 00-7.071.0z"/></svg></a></h2><p>PostgreSQL™ provides a way for developers to customize how a SSL connection is established. This may be used to provide a custom certificate source or other extensions by allowing the developer to create their own <code>SSLContext</code> instance.
The connection URL parameters <code>sslfactory</code> allow the user to specify which custom class to use for creating the <code>SSLSocketFactory</code> . The class name specified by <code>sslfactory</code> must extend <code>javax.net.ssl.SSLSocketFactory</code> and be available to the driver&rsquo;s classloader.</p><p>This class must have a zero argument constructor or a single argument constructor preferentially taking
a <code>Properties</code> argument. There is a simple <code>org.postgresql.ssl.DefaultJavaSSLFactory</code> provided which uses the
default java SSLFactory.</p><p>Information on how to actually implement such a class is beyond the scope of this documentation. Places to look for help are the <a href=https://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html>JSSE Reference Guide</a>
and the source to the <code>NonValidatingFactory</code> provided by the JDBC driver.</p><h2 id=configuring-the-client class=self-link>Configuring the Client <a class=header-link href=#configuring-the-client><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" style="fill:#0093af"><path d="M8.465 11.293c1.133-1.133 3.109-1.133 4.242.0l.707.707 1.414-1.414-.707-.707c-.943-.944-2.199-1.465-3.535-1.465s-2.592.521-3.535 1.465L4.929 12a5.008 5.008.0 000 7.071 4.983 4.983.0 003.535 1.462A4.982 4.982.0 0012 19.071l.707-.707-1.414-1.414-.707.707a3.007 3.007.0 01-4.243.0 3.005 3.005.0 010-4.243l2.122-2.121z"/><path d="m12 4.929-.707.707 1.414 1.414.707-.707a3.007 3.007.0 014.243.0 3.005 3.005.0 010 4.243l-2.122 2.121c-1.133 1.133-3.109 1.133-4.242.0L10.586 12l-1.414 1.414.707.707c.943.944 2.199 1.465 3.535 1.465s2.592-.521 3.535-1.465L19.071 12a5.008 5.008.0 000-7.071 5.006 5.006.0 00-7.071.0z"/></svg></a></h2><p>There are a number of connection parameters for configuring the client for SSL. See <a href=/documentation/use/#connection-parameters/>SSL Connection parameters</a></p><p>The simplest being <code>ssl=true</code> , passing this into the driver will cause the driver to validate both the SSL certificate and verify the hostname (same as <code>verify-full</code> ).</p><blockquote><p><strong>Note</strong></p><p>This is different than libpq which defaults to a non-validating SSL connection.</p></blockquote><p>In this mode, when establishing a SSL connection the JDBC driver will validate the server&rsquo;s identity preventing &ldquo;man in the middle&rdquo; attacks. It does this by checking that the server certificate is signed by a trusted authority, and that the host you are connecting to is the same as the hostname in the certificate.</p><p>If you <strong>require</strong> encryption and want the connection to fail if it can&rsquo;t be encrypted then set <code>sslmode=require</code> this ensures that the server is configured to accept SSL connections for this Host/IP address and that the server recognizes the client certificate. In other words if the server does not accept SSL connections or the client certificate is not recognized the connection will fail.</p><blockquote><p><strong>Note</strong></p><p>In this mode we will accept all server certificates.</p></blockquote><p>If <code>sslmode=verify-ca</code> , the server is verified by checking the certificate chain up to the root certificate stored on the client.</p><p>If <code>sslmode=verify-full</code> , the server host name will be verified to make sure it matches the name stored in the server certificate.</p><p>The SSL connection will fail if the server certificate cannot be verified. <code>verify-full</code> is recommended in most security-sensitive environments.</p><p>The default SSL Socket factory is the LibPQFactory. In the case where the certificate validation is failing you can try <code>sslcert=</code> and LibPQFactory will not send the client certificate. If the server is not configured to authenticate using the certificate it should connect.</p><p>The location of the client certificate, the PKCS-8 client key and root certificate can be overridden with the <code>sslcert</code> , <code>sslkey</code> , and <code>sslrootcert</code> settings respectively. These default to /defaultdir/postgresql.crt, <code>/defaultdir/postgresql.pk8</code> , and <code>/defaultdir/root.crt</code> respectively where defaultdir is <code>${user.home}/.postgresql/</code> in *nix systems and <code>%appdata%/postgresql/</code> on windows</p><p>As of version 42.2.9 PKCS-12 is also supported. In this archive format the client key and the client certificate are in one file, which needs to be set with the <code>sslkey</code> parameter. For the PKCS-12 format to be recognized, the file extension must be &ldquo;.p12&rdquo; (supported since 42.2.9) or &ldquo;.pfx&rdquo; (since 42.2.16). (In this case the <code>sslcert</code> parameter is ignored.)</p><p>Finer control of the SSL connection can be achieved using the <code>sslmode</code> connection parameter.
This parameter is the same as the libpq <code>sslmode</code> parameter and currently implements the
following</p><table><thead><tr><th>sslmode</th><th>Eavesdropping Protection</th><th>MITM Protection</th><th></th></tr></thead><tbody><tr><td>disable</td><td>No</td><td>No</td><td>I don&rsquo;t care about security and don&rsquo;t want to pay the overhead for encryption</td></tr><tr><td>allow</td><td>Maybe</td><td>No</td><td>I don&rsquo;t care about security but will pay the overhead for encryption if the server insists on it</td></tr><tr><td>prefer</td><td>Maybe</td><td>No</td><td>I don&rsquo;t care about encryption but will pay the overhead of encryption if the server supports it</td></tr><tr><td>require</td><td>Yes</td><td>No</td><td>I want my data to be encrypted, and I accept the overhead. I trust that the network will make sure I always connect to the server I want.</td></tr><tr><td>verify-ca</td><td>Yes</td><td>Depends on CA policy</td><td>I want my data encrypted, and I accept the overhead. I want to be sure that I connect to a server that I trust.</td></tr><tr><td>verify-full</td><td>Yes</td><td>Yes</td><td>I want my data encrypted, and I accept the overhead. I want to be sure that I connect to a server I trust, and that it&rsquo;s the one I specify.</td></tr></tbody></table><blockquote><p><strong>NOTE</strong></p><p>If you are using Java&rsquo;s default mechanism (not LibPQFactory) to create the SSL connection you will need to make the server certificate available to Java, the first step is to convert it to a form Java understands.</p></blockquote><p><code>openssl x509 -in server.crt -out server.crt.der -outform der</code></p><p>From here the easiest thing to do is import this certificate into Java&rsquo;s system truststore.</p><p><code>keytool -keystore $JAVA_HOME/lib/security/cacerts -alias postgresql -import -file server.crt.der</code></p><p>The default password for the cacerts keystore is <code>changeit</code> . Setting the alias to postgresql is not required. You may apply any name you wish.</p><p>If you do not have access to the system cacerts truststore you can create your own truststore.</p><p><code>keytool -keystore mystore -alias postgresql -import -file server.crt.der</code></p><p>When starting your Java application you must specify this keystore and password to use.</p><p><code>java -Djavax.net.ssl.trustStore=mystore -Djavax.net.ssl.trustStorePassword=mypassword com.mycompany.MyApp</code></p><p>In the event of problems extra debugging information is available by adding <code>-Djavax.net.debug=ssl</code> to your command line.</p><h3 id=using-ssl-without-certificate-validation class=self-link>Using SSL without Certificate Validation <a class=header-link href=#using-ssl-without-certificate-validation><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" style="fill:#0093af"><path d="M8.465 11.293c1.133-1.133 3.109-1.133 4.242.0l.707.707 1.414-1.414-.707-.707c-.943-.944-2.199-1.465-3.535-1.465s-2.592.521-3.535 1.465L4.929 12a5.008 5.008.0 000 7.071 4.983 4.983.0 003.535 1.462A4.982 4.982.0 0012 19.071l.707-.707-1.414-1.414-.707.707a3.007 3.007.0 01-4.243.0 3.005 3.005.0 010-4.243l2.122-2.121z"/><path d="m12 4.929-.707.707 1.414 1.414.707-.707a3.007 3.007.0 014.243.0 3.005 3.005.0 010 4.243l-2.122 2.121c-1.133 1.133-3.109 1.133-4.242.0L10.586 12l-1.414 1.414.707.707c.943.944 2.199 1.465 3.535 1.465s2.592-.521 3.535-1.465L19.071 12a5.008 5.008.0 000-7.071 5.006 5.006.0 00-7.071.0z"/></svg></a></h3><p>In some situations it may not be possible to configure your Java environment to make the server certificate available, for example in an applet. For a large scale deployment it would be best to get a certificate signed by recognized
certificate authority, but that is not always an option. The JDBC driver provides an option to establish a SSL connection without doing any validation, but please understand the risk involved before enabling this option.</p><p>A non-validating connection is established via a custom <code>SSLSocketFactory</code> class that is provided with the driver. Setting the connection URL parameter <code>sslfactory=org.postgresql.ssl.NonValidatingFactory</code> will turn off all SSL validation.</p><div class=pagination><div class=pagination__left><a class=pagination__left__link title="Previous page" href=https://pgjdbc.github.io/pgjdbc/documentation/use/>Initializing the Driver</a></div><div class=pagination__right><a class=pagination__right__link title="Next page" href=https://pgjdbc.github.io/pgjdbc/documentation/query/>Issuing a Query and Processing the Result</a></div></div></article><aside class=toc><div class=toc__head>Using SSL</div><nav id=TableOfContents><ul><li><a href=#custom-sslsocketfactory>Custom SSLSocketFactory</a></li><li><a href=#configuring-the-client>Configuring the Client</a><ul><li><a href=#using-ssl-without-certificate-validation>Using SSL without Certificate Validation</a></li></ul></li></ul></nav></aside></div></main><footer class=footer role=contentinfo><div class=footer__item><ul role=list class=list><li class=list__head>pgJDBC</li><li><a href=https://jdbc.postgresql.org/documentation/publicapi/index.html class=list__link>Public API</a></li><li><a href=https://www.postgresql.org/ class=list__link>About PostgreSQL</a></li></ul><ul role=list class=list><li class=list__head>Community</li><li><a href=https://github.com/pgjdbc/pgjdbc class=list__link>Github</a></li><li><a href=https://postgres-slack.herokuapp.com/ class=list__link>Slack</a></li><li><a href=https://twitter.com/PostgreSQL class=list__link>Twitter</a></li><li><a href=https://www.postgresql.org/list/pgsql-jdbc/ class=list__link>Mailing List</a></li></ul><ul role=list class=list><li class=list__head>More</li><li><a href=/pgjdbc/faq/ class=list__link>FAQ</a></li><li><a href=https://www.postgresql.org/about/policies/privacy/ class=list__link>Privacy</a></li><li><a href=/pgjdbc/license/ class=list__link>License</a></li></ul></div><div class=copyrights>Copyright © 1996-2022 The PostgreSQL Global Development Group</div></footer><div class=nav-mob><div class="globalmenu mobilemenu dn"><ul role=list><li role=listitem class=hover-bg-black><a href=/pgjdbc/download/>Download</a></li><li role=listitem class=hover-bg-black><a href=/pgjdbc/documentation/>Documentation</a></li><li role=listitem class=hover-bg-black><a href=/pgjdbc/community/>Community</a></li><li role=listitem class=hover-bg-black><a href=/pgjdbc/development/>Development</a></li><li role=listitem class=hover-bg-black><a href=/pgjdbc/changelogs/>Changelogs</a></li></ul></div><div class="docsmenu mobilemenu dn"><ul role=list><li role=listitem class=hover-bg-black><a href=/pgjdbc/documentation/setup/>Getting Started</a></li><li role=listitem class=hover-bg-black><a href=/pgjdbc/documentation/use/>Initializing the Driver</a></li><li role=listitem class=hover-bg-black><a href=/pgjdbc/documentation/ssl/>Using SSL</a></li><li role=listitem class=hover-bg-black><a href=/pgjdbc/documentation/query/>Issuing a Query and Processing the Result</a></li><li role=listitem class=hover-bg-black><a href=/pgjdbc/documentation/callproc/>Calling Stored Functions and Procedures</a></li><li role=listitem class=hover-bg-black><a href=/pgjdbc/documentation/binary-data/>Storing Binary Data</a></li><li role=listitem class=hover-bg-black><a href=/pgjdbc/documentation/escapes/>JDBC escapes</a></li><li role=listitem class=hover-bg-black><a href=/pgjdbc/documentation/server-prepare/>PostgreSQL™ Extensions to the JDBC API</a></li><li role=listitem class=hover-bg-black><a href=/pgjdbc/documentation/thread/>Using the Driver in a Multithreaded or a Servlet Environment</a></li><li role=listitem class=hover-bg-black><a href=/pgjdbc/documentation/datasource/>Connection Pools and Data Sources</a></li><li role=listitem class=hover-bg-black><a href=/pgjdbc/documentation/logging/>Logging using java.util.logging</a></li><li role=listitem class=hover-bg-black><a href=/pgjdbc/documentation/reading/>Further Reading</a></li></ul></div><div class=nav-inside><button class="js-toggle db btn" data-target=.globalmenu>Menu</button>
<button class="js-toggle db btn" data-target=.docsmenu>Docs-Menu</button></div></div></body></html>