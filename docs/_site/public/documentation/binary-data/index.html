<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">

    <link rel="preload" href="https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-100.woff" as="font" type="font/woff" crossorigin>
<link rel="preload" href="https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-100italic.woff" as="font" type="font/woff" crossorigin>
<link rel="preload" href="https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-200.woff" as="font" type="font/woff" crossorigin>
<link rel="preload" href="https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-200italic.woff" as="font" type="font/woff" crossorigin>
<link rel="preload" href="https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-300.woff" as="font" type="font/woff" crossorigin>
<link rel="preload" href="https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-300italic.woff" as="font" type="font/woff" crossorigin>
<link rel="preload" href="https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-400.woff" as="font" type="font/woff" crossorigin>
<link rel="preload" href="https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-400italic.woff" as="font" type="font/woff" crossorigin>
<link rel="preload" href="https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-500.woff" as="font" type="font/woff" crossorigin>
<link rel="preload" href="https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-500italic.woff" as="font" type="font/woff" crossorigin>
<link rel="preload" href="https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-600.woff" as="font" type="font/woff" crossorigin>
<link rel="preload" href="https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-600italic.woff" as="font" type="font/woff" crossorigin>
<link rel="preload" href="https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-700.woff" as="font" type="font/woff" crossorigin>
<link rel="preload" href="https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-700italic.woff" as="font" type="font/woff" crossorigin>
<link rel="preload" href="https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-800.woff" as="font" type="font/woff" crossorigin>
<link rel="preload" href="https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-800italic.woff" as="font" type="font/woff" crossorigin>
<link rel="preload" href="https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-900.woff" as="font" type="font/woff" crossorigin>
<link rel="preload" href="https://pgjdbc.github.io/pgjdbc/fonts/barlow-latin-900italic.woff" as="font" type="font/woff" crossorigin>


    <title>Storing Binary Data | pgJDBC</title>

    <meta name="viewport" content="width=device-width,minimum-scale=1">

    
    
    <link rel="stylesheet" href="https://pgjdbc.github.io/pgjdbc/sass/main.3e2ef319edd90653f8f3c003aab570b6599427631bb60f5e8a9682732adca2ca.css" integrity="sha256-Pi7zGe3ZBlP488ADqrVwtlmUJ2Mbtg9eipaCcyrcoso=">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <link rel="icon" href="/pgjdbc/favicon.ico">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.9/lunr.min.js"
    integrity="sha512-4xUl/d6D6THrAnXAwGajXkoWaeMNwEKK4iNfq5DotEbLPAfk6FSxSP3ydNxqDgCw1c/0Z1Jg6L8h2j+++9BZmg=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script defer language="javascript" type="module" src="/pgjdbc/js/index.js"></script>

</head>

<body>
    

<nav class="navbar" role="navigation">

    <a href="/pgjdbc" id="host">
        <img class="logo" src="/pgjdbc/icons/postgreslogo.svg"  alt="logo" />
    </a>

    <div class="navbar__item">
        
        <a href="/pgjdbc/download/" title="" class="navbar__item__link ">Download</a>
        
        <a href="/pgjdbc/documentation/" title="" class="navbar__item__link ">Documentation</a>
        
        <a href="/pgjdbc/community/" title="" class="navbar__item__link ">Community</a>
        
        <a href="/pgjdbc/development/" title="" class="navbar__item__link ">Development</a>
        
    </div>

    <form id="search" class="searchBox" role="search">
    <input class="searchInput" type="search" name="" placeholder="Search" id="search-input" autocomplete="off">
    <button class="searchButton" for="search-input">
        <svg fill="#ffffff" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="24px" height="24px">
            <path
                d="M 24 2.8886719 C 12.365714 2.8886719 2.8886719 12.365723 2.8886719 24 C 2.8886719 35.634277 12.365714 45.111328 24 45.111328 C 29.036552 45.111328 33.664698 43.331333 37.298828 40.373047 L 52.130859 58.953125 C 52.130859 58.953125 55.379484 59.435984 57.396484 57.333984 C 59.427484 55.215984 58.951172 52.134766 58.951172 52.134766 L 40.373047 37.298828 C 43.331332 33.664697 45.111328 29.036548 45.111328 24 C 45.111328 12.365723 35.634286 2.8886719 24 2.8886719 z M 24 7.1113281 C 33.352549 7.1113281 40.888672 14.647457 40.888672 24 C 40.888672 33.352543 33.352549 40.888672 24 40.888672 C 14.647451 40.888672 7.1113281 33.352543 7.1113281 24 C 7.1113281 14.647457 14.647451 7.1113281 24 7.1113281 z" />
        </svg>
    </button>
</form>

<template id="search-result" hidden>
    <article class="search-list container flow">
        <h2><a class="summary-title-link"></a></h2>
        <summary class="summary"></summary>
        <div class="read-more-container">
            <a class="read-more-link">Read More »</a>
        </div>
    </article>
</template>

</nav>
    <main role="main" class="main-inner">
        
<div class="doc">
    

<nav role="navigation" class="sidebar">
  <ul role="list" class="flow sidebar__wrapper">
    
    <li role="listitem" class="sidebar__links">
      <a href="/pgjdbc/documentation/setup/" class="sidebar__links__link">
        Getting Started
      </a>
    </li>
    <li role="listitem" class="sidebar__links">
      <a href="/pgjdbc/documentation/use/" class="sidebar__links__link">
        Initializing the Driver
      </a>
    </li>
    <li role="listitem" class="sidebar__links">
      <a href="/pgjdbc/documentation/ssl/" class="sidebar__links__link">
        Using SSL
      </a>
    </li>
    <li role="listitem" class="sidebar__links">
      <a href="/pgjdbc/documentation/query/" class="sidebar__links__link">
        Issuing a Query and Processing the Result
      </a>
    </li>
    <li role="listitem" class="sidebar__links">
      <a href="/pgjdbc/documentation/callproc/" class="sidebar__links__link">
        Calling Stored Functions and Procedures
      </a>
    </li>
    <li role="listitem" class="sidebar__links">
      <a href="/pgjdbc/documentation/binary-data/" class="sidebar__links__link--active">
        Storing Binary Data
      </a>
    </li>
    <li role="listitem" class="sidebar__links">
      <a href="/pgjdbc/documentation/escapes/" class="sidebar__links__link">
        JDBC escapes
      </a>
    </li>
    <li role="listitem" class="sidebar__links">
      <a href="/pgjdbc/documentation/server-prepare/" class="sidebar__links__link">
        PostgreSQL™ Extensions to the JDBC API
      </a>
    </li>
    <li role="listitem" class="sidebar__links">
      <a href="/pgjdbc/documentation/thread/" class="sidebar__links__link">
        Using the Driver in a Multithreaded or a Servlet Environment
      </a>
    </li>
    <li role="listitem" class="sidebar__links">
      <a href="/pgjdbc/documentation/datasource/" class="sidebar__links__link">
        Connection Pools and Data Sources
      </a>
    </li>
    <li role="listitem" class="sidebar__links">
      <a href="/pgjdbc/documentation/logging/" class="sidebar__links__link">
        Logging using java.util.logging
      </a>
    </li>
    <li role="listitem" class="sidebar__links">
      <a href="/pgjdbc/documentation/reading/" class="sidebar__links__link">
        Further Reading
      </a>
    </li>
  </ul>
</nav>
    <article class="article">
    <h1>Storing Binary Data
        
    </h1>
    <p>PostgreSQL™ provides two distinct ways to store binary data.  Binary data can be stored in a table using the data type BYTEA or by using the Large Object feature which stores the binary data in a separate table in a special format and refers to that table by storing a value of type OID in your table.</p>
<p>In order to determine which method is appropriate you need to understand the limitations of each method. The BYTEA data type is not well suited for storing very large amounts of binary data. While a column of type BYTEA can hold up to 1 GB of binary data, it would require a huge amount of memory to process such a large value. The Large Object method for storing binary data is better suited to storing very large values, but it has its own limitations.  Specifically deleting a row that contains a Large Object reference does not delete the Large Object. Deleting the Large Object is a separate operation that needs to be performed. Large Objects also have some security issues since anyone connected to the database can view and/or modify any Large Object, even if they don&rsquo;t have permissions to view/update the row containing the Large Object reference.</p>
<p>Version 7.2 was the first release of the JDBC driver that supports the BYTEA data type. The introduction of this functionality in 7.2 has introduced a change in behavior as compared to previous releases. Since 7.2, the methods <code>getBytes()</code> , <code>setBytes()</code> , <code>getBinaryStream()</code> , and <code>setBinaryStream()</code> operate on the BYTEA data type. In 7.1 and earlier, these methods operated on the OID data type associated with Large Objects. It is possible to revert the driver back to the old 7.1 behavior by setting the property <code>compatible</code> on the <code>Connection</code> object to the value <code>7.1</code> . More details on connection properties are available in the section called <a href="/documentation/use/#connection-parameters">Connection Parameters</a>.</p>
<p>To use the BYTEA data type you should simply use the <code>getBytes()</code> , <code>setBytes()</code> , <code>getBinaryStream()</code> , or <code>setBinaryStream()</code> methods.</p>
<p>To use the Large Object functionality you can use either the <code>LargeObject</code> class provided by the PostgreSQL™ JDBC driver, or by using the <code>getBLOB()</code> and <code>setBLOB()</code> methods.</p>
<blockquote>
<p><strong>IMPORTANT</strong></p>
<p>You must access Large Objects within an SQL transaction block.  You can start a transaction block by calling <code>setAutoCommit(false)</code> .</p>
</blockquote>
<p><a href="/documentation/binary-data/#example71processing-binary-data-in-jdbc">Example 7.1, “Processing Binary Data in JDBC”</a> contains some examples on how to process binary data using the PostgreSQL™ JDBC
driver.</p>
<h5 id="example71processing-binary-data-in-jdbc" class="self-link">Example 7.1. Processing Binary Data in JDBC <a class="header-link" href="#example71processing-binary-data-in-jdbc">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
            style="fill: #0093AF;">
            <path
                d="M8.465 11.293c1.133-1.133 3.109-1.133 4.242 0l.707.707 1.414-1.414-.707-.707c-.943-.944-2.199-1.465-3.535-1.465s-2.592.521-3.535 1.465L4.929 12a5.008 5.008 0 0 0 0 7.071 4.983 4.983 0 0 0 3.535 1.462A4.982 4.982 0 0 0 12 19.071l.707-.707-1.414-1.414-.707.707a3.007 3.007 0 0 1-4.243 0 3.005 3.005 0 0 1 0-4.243l2.122-2.121z">
            </path>
            <path
                d="m12 4.929-.707.707 1.414 1.414.707-.707a3.007 3.007 0 0 1 4.243 0 3.005 3.005 0 0 1 0 4.243l-2.122 2.121c-1.133 1.133-3.109 1.133-4.242 0L10.586 12l-1.414 1.414.707.707c.943.944 2.199 1.465 3.535 1.465s2.592-.521 3.535-1.465L19.071 12a5.008 5.008 0 0 0 0-7.071 5.006 5.006 0 0 0-7.071 0z">
            </path>
        </svg>
    </a></h5><p>For example, suppose you have a table containing the file names of images and you
also want to store the image in a BYTEA column:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">images</span><span class="w"> </span><span class="p">(</span><span class="n">imgname</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span><span class="w"> </span><span class="n">img</span><span class="w"> </span><span class="n">bytea</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>To insert an image, you would use:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&#34;myimage.gif&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">FileInputStream</span> <span class="n">fis</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">PreparedStatement</span> <span class="n">ps</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="s">&#34;INSERT INTO images VALUES (?, ?)&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ps</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="n">file</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
</span></span><span class="line"><span class="cl"><span class="n">ps</span><span class="o">.</span><span class="na">setBinaryStream</span><span class="o">(</span><span class="n">2</span><span class="o">,</span> <span class="n">fis</span><span class="o">,</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">file</span><span class="o">.</span><span class="na">length</span><span class="o">());</span>
</span></span><span class="line"><span class="cl"><span class="n">ps</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">ps</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">fis</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span></span></code></pre></div><p>Here, <code>setBinaryStream()</code> transfers a set number of bytes from a stream into the column of type BYTEA. This also could have been done using the <code>setBytes()</code> method if the contents of the image was already in a <code>byte[]</code> .</p>
<blockquote>
<p><strong>NOTE</strong></p>
<p>The length parameter to <code>setBinaryStream</code> must be correct. There is no way to indicate that the stream is of unknown length. If you are in this situation, you must read the stream yourself into temporary storage and determine the length. Now with the correct length you may send the data from temporary storage on to the driver.</p>
</blockquote>
<p>Retrieving an image is even easier. (We use <code>PreparedStatement</code> here, but the <code>Statement</code> class can equally be used.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">PreparedStatement</span> <span class="n">ps</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="s">&#34;SELECT img FROM images WHERE imgname = ?&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ps</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="s">&#34;myimage.gif&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">byte</span><span class="o">[]</span> <span class="n">imgBytes</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="n">1</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// use the data in some way here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="n">rs</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">ps</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span></span></code></pre></div><p>Here the binary data was retrieved as an <code>byte[]</code> .  You could have used a <code>InputStream</code> object instead.</p>
<p>Alternatively you could be storing a very large file and want to use the <code>LargeObject</code> API to store the file:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">imageslo</span><span class="w"> </span><span class="p">(</span><span class="n">imgname</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span><span class="w"> </span><span class="n">imgoid</span><span class="w"> </span><span class="n">oid</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>To insert an image, you would use:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// All LargeObject API calls must be within a transaction block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">conn</span><span class="o">.</span><span class="na">setAutoCommit</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Get the Large Object Manager to perform operations with
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">LargeObjectManager</span> <span class="n">lobj</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">postgresql</span><span class="o">.</span><span class="na">PGConnection</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">getLargeObjectAPI</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Create a new large object
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">long</span> <span class="n">oid</span> <span class="o">=</span> <span class="n">lobj</span><span class="o">.</span><span class="na">createLO</span><span class="o">(</span><span class="n">LargeObjectManager</span><span class="o">.</span><span class="na">READ</span> <span class="o">|</span> <span class="n">LargeObjectManager</span><span class="o">.</span><span class="na">WRITE</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Open the large object for writing
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">LargeObject</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">lobj</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="n">oid</span><span class="o">,</span> <span class="n">LargeObjectManager</span><span class="o">.</span><span class="na">WRITE</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Now open the file
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&#34;myimage.gif&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">FileInputStream</span> <span class="n">fis</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Copy the data from the file to the large object
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">byte</span> <span class="n">buf</span><span class="o">[]</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">2048</span><span class="o">];</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">s</span><span class="o">,</span> <span class="n">tl</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="o">((</span><span class="n">s</span> <span class="o">=</span> <span class="n">fis</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">buf</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">2048</span><span class="o">))</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">obj</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">buf</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">s</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">tl</span> <span class="o">+=</span> <span class="n">s</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Close the large object
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">obj</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Now insert the row into imageslo
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">PreparedStatement</span> <span class="n">ps</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="s">&#34;INSERT INTO imageslo VALUES (?, ?)&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ps</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="n">file</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
</span></span><span class="line"><span class="cl"><span class="n">ps</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="n">2</span><span class="o">,</span> <span class="n">oid</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ps</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">ps</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">fis</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Finally, commit the transaction.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">conn</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
</span></span></code></pre></div><p>Retrieving the image from the Large Object:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// All LargeObject API calls must be within a transaction block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">conn</span><span class="o">.</span><span class="na">setAutoCommit</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Get the Large Object Manager to perform operations with
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">LargeObjectManager</span> <span class="n">lobj</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">postgresql</span><span class="o">.</span><span class="na">PGConnection</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">getLargeObjectAPI</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">PreparedStatement</span> <span class="n">ps</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="s">&#34;SELECT imgoid FROM imageslo WHERE imgname = ?&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ps</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="s">&#34;myimage.gif&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Open the large object for reading
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">long</span> <span class="n">oid</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="na">getLong</span><span class="o">(</span><span class="n">1</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">LargeObject</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">lobj</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="n">oid</span><span class="o">,</span> <span class="n">LargeObjectManager</span><span class="o">.</span><span class="na">READ</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Read the data
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">byte</span> <span class="n">buf</span><span class="o">[]</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">obj</span><span class="o">.</span><span class="na">size</span><span class="o">()];</span>
</span></span><span class="line"><span class="cl">    <span class="n">obj</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">buf</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">obj</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Do something with the data read here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Close the object
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">obj</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="n">rs</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">ps</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Finally, commit the transaction.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">conn</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
</span></span></code></pre></div>

<div class="pagination">
	<div class="pagination__left">
		
		<a class="pagination__left__link" title="Previous page" href="https://pgjdbc.github.io/pgjdbc/documentation/callproc/">
			Calling Stored Functions and Procedures
		</a>
		
	</div>

	<div class="pagination__right">
		
		<a class="pagination__right__link" title="Next page" href="https://pgjdbc.github.io/pgjdbc/documentation/escapes/">
			JDBC escapes
		</a>
		
	</div>
</div></article></div>

    </main>
    <footer class="footer" role="contentinfo">
    <div class="footer__item">
        
        <ul role="list" class="list">
            <li class="list__head">pgJDBC</li>
            <br />
            
            <li><a href="https://jdbc.postgresql.org/documentation/publicapi/index.html" class="list__link">Public API</a></li>
            
            <li><a href="https://www.postgresql.org/" class="list__link">About PostgreSQL</a></li>
            
        </ul>
        
        <ul role="list" class="list">
            <li class="list__head">Community</li>
            <br />
            
            <li><a href="https://github.com/pgjdbc/pgjdbc" class="list__link">Github</a></li>
            
            <li><a href="https://postgres-slack.herokuapp.com/" class="list__link">Slack</a></li>
            
            <li><a href="https://twitter.com/PostgreSQL" class="list__link">Twitter</a></li>
            
            <li><a href="https://www.postgresql.org/list/pgsql-jdbc/" class="list__link">Mailing List</a></li>
            
        </ul>
        
        <ul role="list" class="list">
            <li class="list__head">More</li>
            <br />
            
            <li><a href="/pgjdbc/faq/" class="list__link">FAQ</a></li>
            
            <li><a href="https://www.postgresql.org/about/policies/privacy/" class="list__link">Privacy</a></li>
            
            <li><a href="/pgjdbc/license/" class="list__link">License</a></li>
            
        </ul>
        
    </div>
    <div class="copyrights">
        Copyright © 1996-2022 The PostgreSQL Global Development Group
    </div>
</footer>
</body>

</html>